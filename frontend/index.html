<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRT Server Stream</title>
    <link rel="stylesheet" href="/src/styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-broadcast-tower"></i>
                    <h1>SPRINT GAMING - Server Stream</h1>
                </div>
            </div>
            <div class="header-center">
                <div class="status-indicators">
                    <div class="status-item" id="wsStatus">
                        <i class="fas fa-plug"></i>
                        <span>WebSocket: <strong>Puerto 8765</strong></span>
                    </div>
                    <div class="status-item" id="channelCount">
                        <i class="fas fa-tv"></i>
                        <span>Canales: <strong>0</strong></span>
                    </div>
                    <div class="status-item" id="clientCount">
                        <i class="fas fa-users"></i>
                        <span>Clientes: <strong>0</strong></span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-danger btn-icon" id="btnStopAll" title="Detener todos los streams">
                    <i class="fas fa-stop"></i>
                </button>
                <button class="btn btn-icon" id="btnSettings" title="Configuración">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn btn-icon" id="btnToggleLogs" title="Ver Logs">
                    <i class="fas fa-terminal"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>Canales</h2>
                    <button class="btn btn-primary btn-sm" id="btnAddChannel">
                        <i class="fas fa-plus"></i> Nuevo
                    </button>
                </div>
                <div class="channel-list" id="channelList">
                    <!-- Los canales se agregan dinámicamente -->
                    <div class="empty-state" id="emptyChannels">
                        <i class="fas fa-tv"></i>
                        <p>No hay canales configurados</p>
                        <button class="btn btn-outline btn-sm" id="btnAddChannelEmpty">
                            Agregar Canal
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Content Area -->
            <section class="content-area">
                <!-- Channel Grid -->
                <div class="channel-grid" id="channelGrid">
                    <!-- Las tarjetas de canal se agregan dinámicamente -->
                </div>

                <!-- Welcome/Empty State -->
                <div class="welcome-state" id="welcomeState">
                    <div class="welcome-icon">
                        <i class="fas fa-broadcast-tower"></i>
                    </div>
                    <h1>Server Stream</h1>
                    <h2>Sprint Gaming</h2>
                    <p>Sistema de gestión de streams para producción audiovisual</p>
                    <div class="welcome-features">
                        <div class="feature">
                            <i class="fas fa-video"></i>
                            <span>Gestión de múltiples canales</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-network-wired"></i>
                            <span>Comunicación WebSocket con Aximmetry</span>
                        </div>
                        <div class="feature">
                            <i class="fas fa-eye"></i>
                            <span>Previsualizaciones en tiempo real</span>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-lg" id="btnGetStarted">
                        <i class="fas fa-plus"></i> Crear Primer Canal
                    </button>
                </div>
            </section>
        </main>

        <!-- Logs Panel -->
        <aside class="logs-panel" id="logsPanel">
            <div class="logs-header">
                <h3><i class="fas fa-terminal"></i> Logs de Actividad</h3>
                <div class="logs-actions">
                    <button class="btn btn-icon btn-sm" id="btnClearLogs" title="Limpiar">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn btn-icon btn-sm" id="btnCloseLogs" title="Cerrar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="logs-filter">
                <select id="logFilter">
                    <option value="all">Todos</option>
                    <option value="INFO">Info</option>
                    <option value="ERROR">Errores</option>
                    <option value="DEBUG">Debug</option>
                </select>
            </div>
            <div class="logs-content" id="logsContent">
                <!-- Los logs se agregan dinámicamente -->
            </div>
        </aside>

        <!-- Modals -->
        <!-- Modal: Agregar/Editar Canal -->
        <div class="modal" id="channelModal">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="channelModalTitle">Nuevo Canal</h3>
                    <button class="btn btn-icon" id="btnCloseChannelModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="channelForm">
                        <input type="hidden" id="channelId">
                        
                        <div class="form-group">
                            <label for="channelLabel">Nombre del Canal</label>
                            <input type="text" id="channelLabel" placeholder="Ej: Canal Principal" required>
                            <small class="form-help">Identificador para este slot de reproducción</small>
                        </div>

                        <div class="form-group">
                            <label for="channelSRTName">Nombre del Stream SRT</label>
                            <input type="text" id="channelSRTName" placeholder="Ej: SRT_CANAL_1">
                            <small class="form-help">Nombre con el que Aximmetry recibirá el stream (auto-generado si se deja vacío)</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="btnCancelChannel">Cancelar</button>
                    <button class="btn btn-primary" id="btnSaveChannel">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Configuración -->
        <div class="modal" id="settingsModal">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3>Configuración</h3>
                    <button class="btn btn-icon" id="btnCloseSettingsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-tabs">
                        <button class="tab-btn active" data-tab="general">General</button>
                        <button class="tab-btn" data-tab="encoding">Encoding</button>
                        <button class="tab-btn" data-tab="bitrate">Bitrate</button>
                        <button class="tab-btn" data-tab="srt">SRT</button>
                        <button class="tab-btn" data-tab="network">Red</button>
                    </div>

                    <div class="tab-content active" id="tab-general">
                        <div class="form-group">
                            <label for="settingsTheme">Tema</label>
                            <select id="settingsTheme">
                                <option value="dark">Oscuro</option>
                                <option value="light">Claro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="settingsAutoRestart" checked>
                                <span>Reinicio automático en caso de fallos</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="settingsFFmpegPath">Ruta de FFmpeg</label>
                            <div class="input-with-button">
                                <input type="text" id="settingsFFmpegPath" value="ffmpeg">
                                <button type="button" class="btn btn-outline" id="btnSelectFFmpeg">
                                    <i class="fas fa-folder-open"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="settingsTestPattern">Video Patrón de Prueba</label>
                            <div class="input-with-button">
                                <input type="text" id="settingsTestPattern" placeholder="patron.mp4">
                                <button type="button" class="btn btn-outline" id="btnSelectTestPattern">
                                    <i class="fas fa-folder-open"></i>
                                </button>
                            </div>
                            <small class="form-hint">Video loop para pruebas de conexión SRT</small>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-encoding">
                        <div class="info-box info-box-blue">
                            <i class="fas fa-microchip"></i>
                            <p><strong>Aceleración por Hardware:</strong> Si tienes una tarjeta NVIDIA, selecciona h264_nvenc para mejor rendimiento.</p>
                        </div>
                        <div class="form-group">
                            <label for="settingsVideoEncoder">Encoder de Video</label>
                            <select id="settingsVideoEncoder">
                                <option value="libx264">libx264 (CPU - Compatible)</option>
                                <option value="h264_nvenc">h264_nvenc (NVIDIA GPU)</option>
                                <option value="h264_qsv">h264_qsv (Intel QuickSync)</option>
                                <option value="h264_amf">h264_amf (AMD GPU)</option>
                            </select>
                            <small class="form-hint">NVENC es recomendado si tienes GPU NVIDIA dedicada</small>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="settingsEncoderPreset">Preset</label>
                                <select id="settingsEncoderPreset">
                                    <option value="ultrafast" selected>Ultrafast (más rápido)</option>
                                    <option value="veryfast">Veryfast (recomendado)</option>
                                    <option value="fast">Fast</option>
                                    <option value="medium">Medium (mejor calidad)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="settingsEncoderProfile">Perfil</label>
                                <select id="settingsEncoderProfile">
                                    <option value="baseline" selected>Baseline (menor latencia)</option>
                                    <option value="main">Main (recomendado)</option>
                                    <option value="high">High (mejor calidad)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="settingsEncoderTune">Tune</label>
                                <select id="settingsEncoderTune">
                                    <option value="zerolatency">Zero Latency (streaming)</option>
                                    <option value="film">Film</option>
                                    <option value="animation">Animation</option>
                                    <option value="">Ninguno</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="settingsGopSize">GOP Size (keyframes)</label>
                                <input type="number" id="settingsGopSize" value="15" min="1" max="300">
                                <small class="form-hint">Frames entre keyframes (ej: 15 = 0.5seg a 30fps, menor = baja latencia)</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="settingsBFrames">B-Frames</label>
                            <select id="settingsBFrames">
                                <option value="0">0 (menor latencia - recomendado)</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3 (mejor compresión)</option>
                            </select>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-bitrate">
                        <div class="form-group">
                            <label for="settingsBitrateMode">Modo de Bitrate</label>
                            <select id="settingsBitrateMode">
                                <option value="cbr">CBR (Constante - recomendado para streaming)</option>
                                <option value="vbr">VBR (Variable - mejor calidad)</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="settingsVideoBitrate">Bitrate de Video</label>
                                <input type="text" id="settingsVideoBitrate" value="5M">
                                <small class="form-hint">Ej: 3M, 5M, 10M</small>
                            </div>
                            <div class="form-group">
                                <label for="settingsAudioBitrate">Bitrate de Audio</label>
                                <input type="text" id="settingsAudioBitrate" value="192k">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="settingsMaxBitrate">Max Bitrate</label>
                                <input type="text" id="settingsMaxBitrate" value="5M">
                                <small class="form-hint">Para CBR igual al bitrate</small>
                            </div>
                            <div class="form-group">
                                <label for="settingsBufferSize">Buffer Size</label>
                                <input type="text" id="settingsBufferSize" value="2M">
                                <small class="form-hint">2M para baja latencia, 5M para CBR estándar</small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="settingsFrameRate">Frame Rate por defecto</label>
                            <select id="settingsFrameRate">
                                <option value="24">24 fps</option>
                                <option value="25">25 fps</option>
                                <option value="30">30 fps</option>
                                <option value="50">50 fps</option>
                                <option value="60">60 fps</option>
                            </select>
                        </div>
                        <div class="info-box">
                            <i class="fas fa-calculator"></i>
                            <p><strong>Bitrate recomendado:</strong> 1080p@25fps → 3-5M | 720p@25fps → 2-3M | 576p@25fps → 1.5-2.5M</p>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-srt">
                        <div class="info-box info-box-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p><strong>Importante:</strong> La latencia SRT debe coincidir en emisor y receptor. Mayor latencia = más estabilidad.</p>
                        </div>
                        <div class="form-group">
                            <label for="settingsSRTLatency">Latencia SRT (ms)</label>
                            <input type="number" id="settingsSRTLatency" value="120" min="20" max="8000" step="10">
                            <small class="form-hint">120ms = ultra baja latencia (LAN), 500ms = estable, 1000ms+ = muy estable</small>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="settingsSRTRecvBuffer">Buffer Recepción (MB)</label>
                                <input type="number" id="settingsSRTRecvBuffer" value="2" min="1" max="64">
                            </div>
                            <div class="form-group">
                                <label for="settingsSRTSendBuffer">Buffer Envío (MB)</label>
                                <input type="number" id="settingsSRTSendBuffer" value="2" min="1" max="64">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="settingsSRTOverheadBW">Overhead BW (%)</label>
                                <input type="number" id="settingsSRTOverheadBW" value="25" min="5" max="100">
                                <small class="form-hint">% extra para retransmisiones</small>
                            </div>
                            <div class="form-group">
                                <label for="settingsSRTPeerIdleTime">Peer Idle Timeout (ms)</label>
                                <input type="number" id="settingsSRTPeerIdleTime" value="5000" min="1000" max="30000">
                            </div>
                        </div>
                        <div class="info-box info-box-green">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Configuración actual:</strong> Ultra baja latencia (120ms, 2MB buffers). Si tienes problemas "Cannot keep latency", aumenta a 500ms y 8MB</p>
                        </div>
                    </div>

                    <div class="tab-content" id="tab-network">
                        <div class="form-group">
                            <label for="settingsWSPort">Puerto WebSocket</label>
                            <input type="number" id="settingsWSPort" value="8765">
                        </div>
                        <div class="form-group">
                            <label for="settingsSRTPrefix">Prefijo SRT</label>
                            <input type="text" id="settingsSRTPrefix" value="SRT_SERVER_">
                        </div>
                        <div class="info-box">
                            <i class="fas fa-info-circle"></i>
                            <p>Los clientes Aximmetry se conectan via WebSocket al puerto configurado para solicitar streams de video.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="btnCancelSettings">Cancelar</button>
                    <button class="btn btn-primary" id="btnSaveSettings">
                        <i class="fas fa-save"></i> Guardar Configuración
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal: Confirmación -->
        <div class="modal" id="confirmModal">
            <div class="modal-overlay"></div>
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h3 id="confirmTitle">Confirmar</h3>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage">¿Está seguro?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="btnConfirmCancel">Cancelar</button>
                    <button class="btn btn-danger" id="btnConfirmOk">Confirmar</button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script type="module" src="/src/js/main.js"></script>
</body>
</html>
